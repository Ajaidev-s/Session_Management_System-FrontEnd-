<div
  id="registrationModal"
  class="modal"
  [class.modal-open]="isOpen"
  role="dialog"
  aria-labelledby="modal-title"
  aria-modal="true"
>
  <div class="modal-backdrop" (click)="onClose()" aria-hidden="true"></div>
  <div class="modal-container">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title" class="modal-title">
          Join as {{ roleId === 1 ? 'Student' : 'Trainer' }}
        </h2>
        <button
          class="modal-close"
          (click)="onClose()"
          aria-label="Close registration modal"
          type="button"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M18 6L6 18M6 6L18 18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>

      <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="modal-form" novalidate>
        <!-- Name Fields Row -->
        <div class="form-row">
          <div class="form-group form-group-half">
            <label for="firstName" class="form-label">
              First Name <span class="required-asterisk" aria-hidden="true">*</span>
            </label>
            <input
              id="firstName"
              type="text"
              formControlName="firstName"
              placeholder="Enter first name"
              class="form-input"
              [class.form-input-error]="
                registerForm.get('firstName')?.touched && registerForm.get('firstName')?.invalid
              "
              autocomplete="given-name"
              required
            />
            @if (registerForm.get('firstName')?.touched && registerForm.get('firstName')?.invalid) {
            <small class="form-error" role="alert" aria-live="polite">
              First name is required (minimum 2 characters)
            </small>
            }
          </div>

          <div class="form-group form-group-half">
            <label for="lastName" class="form-label">
              Last Name <span class="required-asterisk" aria-hidden="true">*</span>
            </label>
            <input
              id="lastName"
              type="text"
              formControlName="lastName"
              placeholder="Enter last name"
              class="form-input"
              [class.form-input-error]="
                registerForm.get('lastName')?.touched && registerForm.get('lastName')?.invalid
              "
              autocomplete="family-name"
              required
            />
            @if (registerForm.get('lastName')?.touched && registerForm.get('lastName')?.invalid) {
            <small class="form-error" role="alert" aria-live="polite">
              Last name is required
            </small>
            }
          </div>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <label for="email" class="form-label">
            Email Address <span class="required-asterisk" aria-hidden="true">*</span>
          </label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="Enter your email address"
            class="form-input"
            [class.form-input-error]="
              registerForm.get('email')?.touched && registerForm.get('email')?.invalid
            "
            autocomplete="email"
            required
          />
          @if (registerForm.get('email')?.touched && registerForm.get('email')?.invalid) {
          <small class="form-error" role="alert" aria-live="polite">
            Please enter a valid email address
          </small>
          }
        </div>

        <!-- Password Field -->
        <div class="form-group">
          <label for="password" class="form-label">
            Password <span class="required-asterisk" aria-hidden="true">*</span>
          </label>
          <input
            id="password"
            type="password"
            formControlName="password"
            placeholder="Create a secure password"
            class="form-input"
            [class.form-input-error]="
              registerForm.get('password')?.touched && registerForm.get('password')?.invalid
            "
            autocomplete="new-password"
            required
          />
          @if (registerForm.get('password')?.touched && registerForm.get('password')?.invalid) {
          <small class="form-error" role="alert" aria-live="polite">
            Password must be at least 6 characters long
          </small>
          }
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirmPassword" class="form-label">
            Confirm Password <span class="required-asterisk" aria-hidden="true">*</span>
          </label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            placeholder="Re-enter your password"
            class="form-input"
            [class.form-input-error]="registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched"
            autocomplete="new-password"
            required
          />
          @if (registerForm.errors?.['passwordMismatch'] &&
          registerForm.get('confirmPassword')?.touched) {
          <small class="form-error" role="alert" aria-live="polite"> Passwords do not match </small>
          }
        </div>

        <!-- Error Message -->
        @if (registerError) {
        <div class="form-error-message" role="alert" aria-live="polite">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
            <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" />
            <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" />
          </svg>
          {{ registerError }}
        </div>
        }

        <!-- Submit Button -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary btn-full"
            [class.btn-loading]="isLoading"
            [disabled]="registerForm.invalid || isLoading"
          >
            @if (isLoading) {
            <span class="btn-spinner" aria-hidden="true">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M21 12a9 9 0 11-6.219-8.56"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
            </span>
            Creating Account... } @else { Create {{ roleId === 2 ? 'Student' : 'Trainer' }} Account
            }
          </button>
        </div>

        <!-- Footer Text -->
        <div class="form-footer">
          <p class="form-footer-text">
            By creating an account, you agree to our
            <a href="/terms" class="form-link">Terms of Service</a>
            and
            <a href="/privacy" class="form-link">Privacy Policy</a>.
          </p>
        </div>
      </form>
    </div>
  </div>
</div>
<app-toast></app-toast>
